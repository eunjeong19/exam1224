<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
        $(document).ready(function(){
            // 브라우저를 실행함과 동시에 list ajax 실행
            list_ok();
        });
        function list_ok(){
            $.ajax({
                url:"/api/boards",
                type : "GET",
                data : {
                    search: $("#search").val()
                },
                dataType : "json",
                success : function(data){
                    var head="";
                    var body="";

                    head = "<tr>";
                    head += "<th class='col-1'>No</th>";
                    head += "<th class='col-2'>Title</th>";
                    head += "<th class='col-3'>Content</th>";
                    head += "</tr>";

                    if(data.length == 0){ // 검색 결과가 없을 경우
                        body += "<tr><td colspan=3> 게시글이 없습니다. </td></tr>";
                        $("#list").html(res);
                    } else { // 검색 결과가 있거나 전체 목록이 있는 경우
                        $.each(data, function(i,field){
                            body += "<tr>";
                            body += "<td class='col-1'>"+field.id+"</td>";
                            body += "<td class='col-2'><a href='/board/info/"+field.id+"'>"+field.title+"</a></td>";
                            body += "<td class='col-3'><a href='/board/edit?id="+field.id+"'>"+field.content+"</a></td>";
                            body += "</tr>";
                        });
                        $("#list thead").html(head);
                        $("#list tbody").html(body);
                       }
                }, error:function(xhr){
                    alert(xhr.status);
                    const error = JSON.parse(xhr.responseText);
                    alert(error.message);
                }
            });
        }
        function add_ok(){ // 데이터 등록 ajax
            var obj = {"title":$("#title").val(), "content":$("#content").val()};
            $.ajax({
                url:"/api/boards",
                type:"POST",
                contentType:"application/json; charset=utf-8",
                data: JSON.stringify(obj),
                dataType:"json",
                success:function(data){
                    // alert(data.title+data.content);
                    var res = "<tr>";
                        res += "<td class='col-1'>"+data.id+"</td>";
                        res += "<td class='col-2'><a href='/board/info/"+data.id+"'>"+data.title+"</a></td>";
                        res += "<td class='col-3'><a href='/board/edit?id="+data.id+"'>"+data.content+"</a></td>";
                        res += "</tr>";
                    $("#list").append(res);
                    $("#title").val("");
                    $("#content").val("");
                }, error : function(xhr){
                    alert(xhr.status);
                    const error = JSON.parse(xhr.responseText);
                    alert(error.message);
                }
            });
        }
    </script>
</head>
<body>
{{> layout/top}}
<div class="container my-5" style="max-width:1100px;">

<div class="g-6 mb-5">
    <h3 class="text-center"> 글 전체보기, 검색, 글 등록하기 </h3>
</div>

    <div class="input-group mb-5">
<input type="text" name="search" id="search" class="form-control" placeholder="Search">
<button onclick="list_ok();" class="btn btn-outline-secondary">검색</button>
    </div>
<p></p>


<table class="table table-striped table-bordered" id="list">
    <thead class="table-light"></thead>
    <tbody class="table-group-divider"></tbody>
</table>

<p></p>

    <h3 class="text-center mt-5"> 글 등록하기 </h3>

    <div class="mb-3">
        <label for="title" class="form-label">제목</label>
        <input type="text" name="title" id="title"
               class="form-control" placeholder="제목 입력">
    </div>
    <div class="mb-3">
        <label for="content" class="form-label">내용</label>
        <textarea name="content" id="content"
                class="form-control" placeholder="내용 입력"></textarea>
    </div>
    <div class="d-flex justify-content-end mt-2">
    <input type="button" value="Ajax로 글 등록하기" onclick="add_ok();">
    </div>

</div>
{{> layout/bottom}}
</body>
</html>